name: AvicaRDP-Automation
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Auto restart every 6 hours

jobs:
  build:
    name: Start RDP Setup
    runs-on: windows-latest
    timeout-minutes: 350  # Increased time limit

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Python and Dependencies
        run: |
          python.exe -m ensurepip
          python.exe -m pip install requests pyautogui

      - name: Download Required Files
        run: |
          Invoke-WebRequest -Uri "https://github.com/sammikum/rdp-setup/blob/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"

      - name: Enable Remote Desktop
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

      - name: Set User Password
        run: net user runneradmin TheDisa1a

      - name: Run Setup Script
        run: |
          Start-Process "Avica_setup.exe"
          python setup.py

      - name: Show Connection Info
        run: |
          echo "
          ╔══════════════════════════════════════╗
          ║        AVICA RDP CONNECTION          ║  
          ╚══════════════════════════════════════╝
          
          📱 Telegram : @TheNetworkZoneOfficial
          👨‍💻 Credits : @PiroYadav & @TheYadavNetwork
          
          📋 Instructions:
          • Go to the GoFile link that will appear below
          • Get Avica ID and Password from there
          • Download Avica app and connect
          • GoFile link changes every time!
          
          ⏳ Waiting for GoFile link...
          "

      - name: Start Avica Service
        run: cmd /c show.bat

      - name: Keep Session Active
        run: cmd /c loop.bat
